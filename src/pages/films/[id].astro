---
import Layout from "../../layouts/Layout.astro";
import CardFeaturing from "../../components/CardFeaturing.astro";
import { getFilm, getInvite } from "../../../backend/backend.mjs";

const { id } = Astro.params;
const film = await getFilm(id);
console.log(film);
const invite = await getInvite(film.accompagner);
console.log(invite);
---

<Layout
    titre={film.titre}
    photo_URL={film.photo_URL}
    infos={[film.annee_string, film.duree + " min", film.genre[0]]}
>
        <section class="section flex-row">
            <img
                class="w-[125px] h-[175px] object-cover"
                src={film.affiche_URL}
                alt="Affiche du film"
                loading="lazy"
            />
            <div class="flex flex-col gap-2">
                <p class="font-heading text-xl">{film.titre}</p>
                <div class="flex gap-2 text-sm">
                    <p>{film.annee_string}</p>
                    <p>{film.duree} min</p>
                </div>
                <div
                    class="flex flex-wrap gap-2 text-xs font-semibold *:border-1 *:rounded-md *:p-1"
                >
                    {film.genre.map((gen) => <p>{gen}</p>)}
                </div>
                {
                    film.liste_acteurs ? (
                        <p class="text-xs">Acteurs : {film.liste_acteurs}</p>
                    ) : (
                        ""
                    )
                }
            </div>
        </section>
        <section class="section">
            <h3>Synopsis</h3>
            <p>{film.description}</p>
        </section>
        {
            film.bande_annonce_embed ? (
                <section class="section">
                    <h3>Bande-annonce</h3>
                    <iframe
                        width="full"
                        height="250"
                        src={film.bande_annonce_embed}
                        allow="autoplay; encrypted-media; gyroscope"
                        referrerpolicy="strict-origin-when-cross-origin"
                        allowfullscreen
                    />
                </section>
            ) : (
                ""
            )
        }
        <CardFeaturing {...invite} jour={film.jour} heure={film.heure} filmBool={true}/>
        <a href="/films" class="btn self-end">Voir les autres films</a>
</Layout>
